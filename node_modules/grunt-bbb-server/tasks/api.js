require('express-namespace');
var encoder = require('./encoder');

module.exports = function(server, apiroot, db){

    if(server.namespace){
        server.namespace(apiroot, function(){
            server.get('/songs', function(req, res, next){
                db.findSongs({}, res);
            });
            server.get('/songs/:id', function(req, res, next){
                db.findSongById(req.params.id, res);
            });
            server.post('/songs', function(req, res, next){
                if(req.body){
                    db.saveSong(req.body, res, function(err, id){
                        if(!err) encoder.encodeSong(req.body, id);
                    });
                }
            });
            server.put('/songs/:id', function(req, res, next){
                if(req.body){
                    db.saveSong(req.body, res, function(err, id){
                        if(!err) encoder.encodeSong(req.body, id);
                    });
                }
            });
        });
    }
};